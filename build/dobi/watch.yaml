job=dev:
    net-mode: host
    use: dev-image
    user: "{user.uid}"
    mounts: [source]
    interactive: true
    command: concurrently "go run src/api/main.go" "node start"
    depends: [vars]
    env:
      - "NODE_ENV=development"

job=stage:
    net-mode: host
    user: "{user.uid}"
    use: dev-image
    mounts: [source]
    interactive: true
    command: concurrently "go run src/api/main.go" "node hot.js"
    depends: [vars,delete,frontend-staging]
    env:
      - "NODE_ENV=development"

job=prod:
    net-mode: host
    user: "{user.uid}"
    use: dev-image
    mounts: [source]
    interactive: true
    command: concurrently "go run src/api/main.go" "node www/express.bundle.js"
    depends: [vars,delete,frontend-production]
    env:
      - "NODE_ENV=production"
